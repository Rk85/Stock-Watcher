<div id="transAddModal" class="modal hide fade tansAddModal" data-bind="with: $root.transModalDetails">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
    <h3 id="myModalLabel" data-bind="text:headerName"></h3>
  </div>
  <div id="transModalBody" class="modal-body">
    <table class="table modal-table">
      <thead class="trans-table-head" >
        <tr>
          <th class="trans-table-head-company"><span>Company</span></th>
          <th><span class="modal-header">Inv Price</span></th>
          <th><span class="modal-header">Date</span></th>
          <th><span class="modal-header">Quantity</span></th>
          <th><span class="modal-header">Comments</span></th>
          <th data-bind="ifnot: isEdit">
            <span>
              <i data-bind="click: function(data, event) { 
                    transDetails.push(newTransDetail(data))
                  },
                  css: 'icon-plus-sign, company-action-column'">
              </i>
            </span>
          </th>
        </tr>
      </thead>
      <tbody data-bind="foreach: transDetails">
        <tr>
          <td class="'company-name-column'">
            <a data-bind="text: companyName, css: 'company-name-name-link'"></a>
          </td>
          <td><input data-bind="value:invPrice" type="text" class="input-mini"/></td>
          <td>
            <input data-bind="attr:{ id: 'datepicker'+$index()}, 
                              value:invDate,
                              event: {
                                 mousedown : function(){
                                          $('#datepicker'+$index()).datepicker();
                                          return true;
                                        }
                              }" 
                  type="text" class="input-small"/>
          </td>
          <td><input data-bind="value:quantity" type="text" class="input-mini"/></td>
          <td><input data-bind="value:comments" type="text" class="input-medium"/></td>
          <td data-bind="ifnot: $parent.isEdit">
            <span>
              <i data-bind="click: function(data, event) { 
                    $parent.transDetails.remove(data)
                  }, css: 'icon-remove-sign, company-action-column'">
              </i>
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <button class="btn, modal-close-button" data-dismiss="modal" aria-hidden="true">Close</button>
    <button data-dismiss="modal" data-bind="enable: transDetails().length > 0, css: 'btn modal-default-button', click: saveAction">Save changes</button>
  </div>
</div>
<script>
(function (stockWatcher, $) {
  stockWatcher.transModals = function transModals(data, parent) {
    var self = this;
    self.newTransDetail = function newTransDetail(details) {
      return {
        companyName: ko.observable(data.companyName || ''),
        invPrice: ko.observable(details.invPrice || ''),
        invDate: ko.observable(details.invDate || ''),
        quantity: ko.observable(details.quantity || ''),
        comments: ko.observable(details.comments || '')
      };
    };
    self.headerName = ko.observable(data.headerName || 'Add New Transaction');
    self.isEdit = ko.observable(data.isEdit || false);
    self.transDetails = ko.observableArray([
      self.newTransDetail(data)
    ]);
    self.saveAction = function saveAction() {
      if (data.onSave) {
        data.onSave(self.transDetails());
      }
    };
  };
}(Application.namespace("Application.stockWatcher"), jQuery));
</script>
