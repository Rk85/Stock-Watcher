<div class="container-fluid" id="invest_portfolio">
  <div class="row-fluid">
    <div class="span6 portfolio">
      {% block portfolio_header %}{% endblock portfolio_header %}
      <div class="row-fluid">
        {% block portfolio_max_gainer %}{% endblock portfolio_max_gainer %}
        {% block portfolio_max_loser %}{% endblock portfolio_max_loser %}
      </div>
    </div>
  </div>
  <div class="row-fluid trans-div">
    {% block profile_select_div %}{% endblock profile_select_div %}
    {% block portfolio_trans %}{% endblock portfolio_trans %}
  </div>
</div>
{% include "utils/modals.html" %}

<script>

(function (stockWatcher, $) {

  var totalDetails = function totalDetails(details) {
    return {
      totalValue: "877,234",
      totalChange: "+10000",
      changePercent: "(+15.0%)",
      valueInc: true,
      maxGainerName: 'Company Name',
      maxGainerValue: 30.50,
      maxGainerChange: "+5.50",
      maxGainerChangePercent: "(+5.50)",
      maxLoserName: 'Company Name',
      maxLoserValue: 30.50,
      maxLoserChange: "+5.50",
      maxLoserChangePercent: "(+5.50)"
    }
  };

  var profileCompanyRows = function profileCompanyRows(details){
    return {
      companyName: details.company_name,
      invPrice: 20,
      quantity: 100,
      invAmount: 5000,
      livePrice: 60,
      todayChange: 10,
      todayGain: 50,
      todayPercentage: '2%',
      totalChange: 10,
      totalGain: 50,
      totalPercentage: '2%',
      profileId: details.profile_id || 1,
      transactionDetails: ko.observableArray([{
        companyName: details.company_name,
      invPrice: 20,
      quantity: 100,
      invAmount: 5000,
      livePrice: 60,
      todayChange: 10,
      todayGain: 50,
      todayPercentage: '2%',
      totalChange: 10,
      totalGain: 50,
      totalPercentage: '2%',
      profileId: details.profile_id || 1
      }]),
      comapnyTransShow: ko.observable(false)
    }
  }

  stockWatcher.portFolio = function portFolio(data) {
    var self = this;
    self.userName = ko.observable('Guest');
    self.showToday = ko.observable(true);
    self.changePortfolioType = function () {
      self.showToday(!self.showToday());
    };
    self.todayDetails = ko.observable(new totalDetails({}));
    self.totalDetails = ko.observable(new totalDetails({}));
    self.portFolioDetails = ko.computed(function () {
      return self.showToday() ?
          {
            linkName: 'Today',
            linkValue: self.todayDetails
          } :
          {
            linkName: 'OverAll',
            linkValue: self.totalDetails
          };
    });
    self.availableProfiles = ko.observableArray([
      {
        id: 1,
        name: 'test'
      },
      {
        id: 2,
        name: 'test2'
      }
    ]);
    self.selectedProfile = ko.observable();
    self.availableRefreshRates = ko.observableArray([
      {
        id: 1,
        name: '2 minutes'
      },
      {
        id: 2,
        name: '5 minutes'
      }
    ]);
    self.selectedRefreshRate = ko.observable();
    self.totalTableRows = ko.observableArray([
      new profileCompanyRows({company_name: "NAME1", profile_id: 1}),
      new profileCompanyRows({company_name: "NAME3", profile_id: 1}),
      new profileCompanyRows({company_name: "NAME2", profile_id: 2})
    ]);
    self.availableRows = ko.computed(function () {
      if (self.selectedProfile()) {
        return ko.utils.arrayFilter(self.totalTableRows() || [], function (row) {
          return row.profileId === self.selectedProfile().id;
        });
      }
      return [];
    });
    self.addNewTransDetails = ko.observable(new Application.stockWatcher.transModals(self, {}));
    self.transAdd = function transAdd(isAdd, rowData, event) {
      if (isAdd === 1) {
        alert('testadd')
        self.addNewTransDetails(new Application.stockWatcher.transModals(self, rowData));
      } else if (isAdd === 0) {
        var result = Application.showAlert(
          {
            msg: "Do you want to delete this Company?",
            callBack: function (result) {
              if (result) {
                self.totalTableRows.remove(rowData);
              }
            }
          }
        );
      }
    };
    self.availableQoutes = ko.observableArray([
    ]);
  };
}(Application.namespace("Application.stockWatcher"), jQuery));

var applyFormBindings = function (data, tab_id) {
  var model = new Application.stockWatcher.portFolio(data);
  ko.applyBindings(model, $(tab_id)[0]);
};
</script>
